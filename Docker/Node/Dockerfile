# âœ… Use a specific minimal Node.js version with Alpine
FROM node:20-alpine AS base

# ğŸ§¼ Create a non-root user for better security
RUN addgroup app && adduser -S -G app app

# ğŸ“ Set working directory
WORKDIR /app

# ğŸ”’ Use only package.json and lock file for better cache management
COPY package*.json ./

# ğŸ“¦ Install dependencies (in a separate layer to improve caching)
RUN npm ci --omit=dev

# ğŸ§ Switch to non-root user
USER app

# ğŸ“ Copy application code after installing deps to optimize Docker caching
COPY --chown=app:app . .

# ğŸŒ Set environment variable
ENV PORT=8000

# ğŸšª Expose the app port
EXPOSE 8000

# ğŸš€ Start the app
CMD ["node", "index.js"]
